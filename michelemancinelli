<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guida Completa Detrazioni 2026: Lavori e Spese</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Phosphor Icons for cleaner visuals -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            color: #334155;
        }

        .flow-line {
            width: 2px;
            background-color: #CBD5E1;
            margin: 0 auto;
            height: 24px;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .check-item {
            transition: all 0.2s;
        }
        .check-item:hover {
            background-color: #ECFDF5;
            transform: translateX(4px);
        }

        /* Animation for list items */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
    </style>
    <!-- Chosen Palette: 
         - Privato: Emerald/Teal (Positive, Tax Savings)
         - Società: Indigo/Purple (Corporate, Business)
    -->
    <!-- Application Structure Plan:
         1. Header: Switcher Mode.
         2. Main Calculator: Input Budget + House Type (Crucial for Prima/Seconda Rate).
         3. "What Deductible" Section (NEW): Detailed breakdown of Works, Professionals, Admin costs.
         4. Results Flow: Visual waterfall of the money.
    -->
    <!-- Visualization Choices:
         - Interactive Checklist: To show "What counts".
         - Waterfall: To show "How much returns".
    -->
</head>
<body class="bg-slate-50 min-h-screen pb-12">

    <!-- Header & Mode Switcher -->
    <div class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-slate-900 text-white p-2 rounded-lg font-bold text-xl"><i class="ph ph-calculator"></i></div>
                <div>
                    <h1 class="font-bold text-slate-800 text-lg leading-tight">Simulatore 2026</h1>
                    <p class="text-xs text-slate-500 hidden sm:block">Analisi Costi e Detrazioni</p>
                </div>
            </div>
            
            <div class="flex bg-slate-100 p-1 rounded-xl">
                <button onclick="setMode('privato')" id="btn-privato" class="flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg text-sm font-bold transition-all shadow-sm bg-emerald-600 text-white">
                    <i class="ph ph-user"></i> <span class="hidden sm:inline">Privato</span>
                </button>
                <button onclick="setMode('societa')" id="btn-societa" class="flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-purple-700">
                    <i class="ph ph-buildings"></i> <span class="hidden sm:inline">Società</span>
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-6xl mx-auto px-4 mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- LEFT COLUMN: INPUTS & CHECKLIST -->
        <div class="lg:col-span-7 space-y-6">
            
            <!-- Input Card -->
            <div class="bg-white rounded-2xl p-6 card-shadow border border-slate-100">
                <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <i class="ph ph-sliders-horizontal"></i> Configurazione Intervento
                </h2>
                
                <!-- Budget Input -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Budget Totale Stimato (IVA Inclusa)</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-slate-400 font-bold">€</span>
                        <input type="number" id="input-budget" value="80000" step="1000" oninput="calculate()" 
                            class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 font-bold text-xl text-slate-800 focus:border-emerald-500 focus:outline-none transition-colors">
                    </div>
                    <input type="range" id="range-budget" min="5000" max="200000" step="1000" value="80000" oninput="syncInput(this.value)"
                        class="w-full mt-4 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                </div>

                <!-- Type Selector (Only for Privato) -->
                <div id="private-settings" class="pt-4 border-t border-slate-100">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Tipologia Immobile</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="houseType" value="prima" checked onchange="calculate()" class="peer sr-only">
                            <div class="p-3 rounded-xl border-2 border-slate-200 peer-checked:border-emerald-500 peer-checked:bg-emerald-50 transition-all flex items-center gap-3">
                                <div class="bg-emerald-100 text-emerald-700 p-2 rounded-lg"><i class="ph ph-house-line text-xl"></i></div>
                                <div>
                                    <span class="block font-bold text-slate-700 text-sm">Prima Casa</span>
                                    <span class="block text-xs text-slate-500">Bonus Potenziato (Ipotesi 50%)</span>
                                </div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="houseType" value="seconda" onchange="calculate()" class="peer sr-only">
                            <div class="p-3 rounded-xl border-2 border-slate-200 peer-checked:border-emerald-500 peer-checked:bg-emerald-50 transition-all flex items-center gap-3">
                                <div class="bg-slate-100 text-slate-700 p-2 rounded-lg"><i class="ph ph-house text-xl"></i></div>
                                <div>
                                    <span class="block font-bold text-slate-700 text-sm">Seconda Casa</span>
                                    <span class="block text-xs text-slate-500">Bonus Base (36%)</span>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- NEW SECTION: CHECKLIST DETRAIBILI -->
            <div id="checklist-card" class="bg-white rounded-2xl p-6 card-shadow border border-slate-100">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <i class="ph ph-check-circle text-emerald-600 text-2xl"></i>
                        Cosa puoi scaricare?
                    </h3>
                    <span class="text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded-full font-bold">Lista 2026</span>
                </div>
                
                <p class="text-sm text-slate-600 mb-6">
                    Indipendentemente che sia Prima o Seconda casa, <strong>queste sono le 3 categorie di spese</strong> che formano il totale detraibile:
                </p>

                <div class="space-y-4">
                    
                    <!-- Category 1: Lavori -->
                    <div class="border border-slate-200 rounded-xl overflow-hidden">
                        <div class="bg-slate-50 p-3 font-bold text-slate-700 flex items-center gap-2 border-b border-slate-200">
                            <i class="ph ph-hammer text-orange-500"></i> 1. Lavori Edili (Manutenzione Straordinaria)
                        </div>
                        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-600">
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Demolizione e ricostruzione pareti</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Realizzazione/Rifacimento impianti (Elettrico, Idraulico)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Sostituzione infissi e serramenti (con modifica materiale/forma)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Installazione ascensori/montacarichi</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Rifacimento tetto e facciate</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Ristrutturazione bagno (tubature, non solo piastrelle)</div>
                        </div>
                    </div>

                    <!-- Category 2: Spese Tecniche -->
                    <div class="border border-slate-200 rounded-xl overflow-hidden">
                        <div class="bg-slate-50 p-3 font-bold text-slate-700 flex items-center gap-2 border-b border-slate-200">
                            <i class="ph ph-pencil-ruler text-blue-500"></i> 2. Spese Professionali
                        </div>
                        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-600">
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Progettazione (Architetto/Geometra)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Direzione Lavori</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Redazione APE (Attestato Prestazione Energetica)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Coordinatore della Sicurezza (PSC/POS)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Perizie e sopralluoghi tecnici</div>
                        </div>
                    </div>

                    <!-- Category 3: Oneri -->
                    <div class="border border-slate-200 rounded-xl overflow-hidden">
                        <div class="bg-slate-50 p-3 font-bold text-slate-700 flex items-center gap-2 border-b border-slate-200">
                            <i class="ph ph-file-text text-purple-500"></i> 3. Oneri e Burocrazia
                        </div>
                        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-600">
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> IVA sui lavori (Agevolata 10% o Ordinaria 22%)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Diritti di segreteria (CILA, SCIA, Permesso di Costruire)</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Oneri di urbanizzazione</div>
                            <div class="check-item flex items-center gap-2 p-2 rounded"><i class="ph ph-check text-emerald-500"></i> Imposte di bollo sulle pratiche</div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN: RESULTS & WATERFALL -->
        <div class="lg:col-span-5 space-y-6">

            <!-- Flow Calculation Card -->
            <div class="bg-white rounded-2xl p-8 card-shadow border border-slate-100 relative overflow-hidden">
                <div id="mode-stripe" class="absolute top-0 left-0 w-full h-2 bg-emerald-500"></div>

                <h3 class="text-xl font-bold text-slate-800 mb-6">Il Tuo Recupero Fiscale</h3>

                <!-- Step 1 -->
                <div class="flex justify-between items-center text-sm">
                    <span class="text-slate-500">Importo Spese Totali</span>
                    <span class="font-bold text-slate-800 text-lg" id="val-start">€ 80.000</span>
                </div>

                <div class="flow-line bg-slate-200 h-6 w-0.5 mx-auto my-1"></div>

                <!-- Step 2: Massimale -->
                <div class="bg-slate-50 p-3 rounded-lg border border-slate-200 text-center relative">
                    <div id="excess-badge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold">TAGLIO ECCEDENZA</div>
                    <p class="text-xs font-bold text-slate-400 uppercase">Massimale Applicabile</p>
                    <p class="font-bold text-slate-700" id="val-limit">€ 96.000</p>
                    <p class="text-xs text-slate-400" id="label-limit-desc">Prima Casa (Ipotesi 2026)</p>
                </div>

                <div class="flow-line bg-slate-200 h-6 w-0.5 mx-auto my-1"></div>

                <!-- Step 3: Base -->
                <div class="flex justify-between items-center text-sm">
                    <span class="text-slate-500">Base di Calcolo</span>
                    <span class="font-bold text-slate-800 text-lg" id="val-base">€ 80.000</span>
                </div>

                <div class="flow-line bg-slate-200 h-6 w-0.5 mx-auto my-1"></div>

                <!-- Step 4: Aliquota -->
                <div class="bg-emerald-50 border border-emerald-100 p-2 rounded text-center text-emerald-700 font-bold text-sm" id="box-rate">
                    × 50% (Aliquota)
                </div>

                <div class="flow-line bg-emerald-200 h-6 w-0.5 mx-auto my-1"></div>

                <!-- Step 5: TOTALONE -->
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl text-center">
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2">Credito Totale Spettante</p>
                    <p class="text-4xl font-bold text-emerald-400 mb-2" id="val-total">€ 40.000</p>
                    <div class="h-px bg-slate-600 w-1/2 mx-auto my-3"></div>
                    <p class="text-xl font-semibold" id="val-annual">€ 4.000 <span class="text-sm font-normal text-slate-400">/ anno</span></p>
                    <p class="text-xs text-slate-500 mt-1">Recupero in 10 anni (730/Unico)</p>
                </div>

            </div>

            <!-- Comparison Chart -->
            <div class="bg-white rounded-2xl p-6 card-shadow border border-slate-100">
                <h4 class="text-xs font-bold text-slate-400 uppercase mb-4">Costo Reale vs Recupero</h4>
                <div class="relative h-48 w-full">
                    <canvas id="resultChart"></canvas>
                </div>
            </div>

            <!-- Info Box -->
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-sm text-blue-800">
                <h4 class="font-bold mb-1 flex items-center gap-2"><i class="ph ph-info"></i> Nota Importante</h4>
                <p>
                    Per portare in detrazione queste spese, i pagamenti devono essere effettuati tassativamente tramite <strong>Bonifico Parlante</strong> per ristrutturazioni (Art. 16-bis).
                    Conserva tutte le fatture e le ricevute dei bonifici per 10 anni.
                </p>
            </div>

        </div>

    </main>

    <script>
        let currentMode = 'privato';
        let chartInstance = null;

        // Configuration for 2026 Scenarios
        const SCENARIOS = {
            privato: {
                prima: { limit: 96000, rate: 0.50, name: "Prima Casa (Ipotesi Estensione)" }, // Optimistic/Likely for First Home
                seconda: { limit: 48000, rate: 0.36, name: "Seconda Casa (Decalage)" }       // Standard Decalage
            },
            societa: {
                limit: Infinity, // Deduction has no cap usually
                rate: 0.24,      // IRES
                name: "Deduzione IRES"
            }
        };

        function init() {
            const ctx = document.getElementById('resultChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['A Tuo Carico', 'Recupero Fiscale'],
                    datasets: [{
                        data: [50, 50],
                        backgroundColor: ['#E2E8F0', '#10B981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });
            calculate();
        }

        function setMode(mode) {
            currentMode = mode;
            const btnP = document.getElementById('btn-privato');
            const btnS = document.getElementById('btn-societa');
            const pSet = document.getElementById('private-settings');
            const checkList = document.getElementById('checklist-card');
            const stripe = document.getElementById('mode-stripe');

            if(mode === 'privato') {
                btnP.className = "flex items-center gap-2 px-6 py-2 rounded-lg text-sm font-bold transition-all shadow-sm bg-emerald-600 text-white";
                btnS.className = "flex items-center gap-2 px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-purple-700";
                pSet.classList.remove('hidden');
                checkList.classList.remove('hidden'); // Show checklist for private
                stripe.className = "absolute top-0 left-0 w-full h-2 bg-emerald-500";
            } else {
                btnS.className = "flex items-center gap-2 px-6 py-2 rounded-lg text-sm font-bold transition-all shadow-sm bg-purple-600 text-white";
                btnP.className = "flex items-center gap-2 px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-emerald-700";
                pSet.classList.add('hidden');
                checkList.classList.add('hidden'); // Hide checklist for company (different rules)
                stripe.className = "absolute top-0 left-0 w-full h-2 bg-purple-500";
            }
            calculate();
        }

        function syncInput(val) {
            document.getElementById('input-budget').value = val;
            calculate();
        }

        function calculate() {
            const budget = parseFloat(document.getElementById('input-budget').value) || 0;
            
            let limit, rate, label;

            if (currentMode === 'privato') {
                // Check Radio Button
                const isPrima = document.querySelector('input[name="houseType"]:checked').value === 'prima';
                const scenario = isPrima ? SCENARIOS.privato.prima : SCENARIOS.privato.seconda;
                
                limit = scenario.limit;
                rate = scenario.rate;
                label = scenario.name;

                // Update checklist visibility (redundant check but good for safety)
                document.getElementById('checklist-card').style.display = 'block';

            } else {
                // Societa
                limit = SCENARIOS.societa.limit;
                rate = SCENARIOS.societa.rate;
                label = SCENARIOS.societa.name;
                
                document.getElementById('checklist-card').style.display = 'none';
            }

            // Calculation Logic
            let base = budget;
            let excess = 0;

            if (limit !== Infinity && budget > limit) {
                base = limit;
                excess = budget - limit;
                document.getElementById('excess-badge').classList.remove('hidden');
            } else {
                document.getElementById('excess-badge').classList.add('hidden');
            }

            const totalCredit = base * rate;
            const years = currentMode === 'privato' ? 10 : 1; // Simplified for visual, though amortization is multi-year
            const annual = currentMode === 'privato' ? (totalCredit / 10) : totalCredit; // For company this is just "Total Saving" visually here
            
            // DOM Updates
            document.getElementById('val-start').innerText = "€ " + budget.toLocaleString('it-IT');
            document.getElementById('val-limit').innerText = limit === Infinity ? "Nessun Limite" : "€ " + limit.toLocaleString('it-IT');
            document.getElementById('label-limit-desc').innerText = label;
            document.getElementById('val-base').innerText = "€ " + base.toLocaleString('it-IT');
            
            const boxRate = document.getElementById('box-rate');
            boxRate.innerText = `× ${(rate*100).toFixed(0)}% (Aliquota Applicata)`;
            boxRate.className = currentMode === 'privato' 
                ? "bg-emerald-50 border border-emerald-100 p-2 rounded text-center text-emerald-700 font-bold text-sm"
                : "bg-purple-50 border border-purple-100 p-2 rounded text-center text-purple-700 font-bold text-sm";

            const valTotal = document.getElementById('val-total');
            valTotal.innerText = "€ " + totalCredit.toLocaleString('it-IT', {maximumFractionDigits: 0});
            valTotal.className = currentMode === 'privato' 
                ? "text-4xl font-bold text-emerald-400 mb-2" 
                : "text-4xl font-bold text-purple-400 mb-2";

            if (currentMode === 'privato') {
                document.getElementById('val-annual').innerHTML = `€ ${annual.toLocaleString('it-IT', {maximumFractionDigits: 0})} <span class="text-sm font-normal text-slate-400">/ anno</span>`;
            } else {
                document.getElementById('val-annual').innerHTML = `Risparmio IRES Totale`; // Simplified for companies
            }

            // Chart
            const cost = budget - totalCredit;
            chartInstance.data.datasets[0].data = [cost, totalCredit];
            chartInstance.data.datasets[0].backgroundColor = ['#CBD5E1', currentMode === 'privato' ? '#10B981' : '#9333EA'];
            chartInstance.update();
        }

        window.onload = init;
    </script>
</body>
</html>
